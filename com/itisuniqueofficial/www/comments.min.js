const config={apiEndpoint:"https://www.itisuniqueofficial.com/feeds/comments/default?alt=json&max-results=1000",initialComments:10,loadMoreCount:5,showAvatar:!0,avatarSize:50,roundAvatar:!0,characters:150,showMoreLink:!0,moreLinkText:"Read More",animationDuration:300,defaultAvatar:"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjit9MCnrMRXaYOqLwqsPIzmWRnN1Hr7rt3NHkgAHI5fTGEpn8PZ-yNGZicjo6_7YeFlWpPR8FQPx5Lyg2Xxtv-HhUEnofyuz4w9MlTrL9Jz86HjlYoPOagfZK_Rr79lYIj9ekYIUfJldvY6N0FmQ49Suf5MciTOlBqRgNKH_-xjUhJvAw/s1600/user.png"},debounce=(t,e)=>{let n;return(...o)=>(clearTimeout(n),n=setTimeout(()=>t.apply(this,o),e))};class CommentsWidget{constructor(){this.allComments=[],this.displayedComments=config.initialComments,this.container=document.getElementById("idbcomments"),this.loader=document.getElementById("comments-loader"),this.loadMoreBtn=document.getElementById("load-more-comments"),this.countElement=document.getElementById("comments-count"),this.isLoadingMore=!1,this.init()}async init(){this.bindEvents(),await this.fetchComments(),this.setupIntersectionObserver()}bindEvents(){this.loadMoreBtn.addEventListener("click",debounce(()=>this.loadMore(),300))}async fetchComments(){this.showLoader(!0);try{const t=await fetch(config.apiEndpoint,{cache:"no-store"});if(!t.ok)throw new Error("Network response was not ok");const e=await t.json();this.allComments=(e.feed.entry||[]).sort((t,e)=>new Date(e.published.$t)-new Date(t.published.$t)),this.renderComments(),this.updateUI()}catch(t){console.error("Failed to load comments:",t),this.showError()}finally{this.showLoader(!1)}}renderComments(){this.container.innerHTML="";const t=document.createDocumentFragment();this.allComments.slice(0,this.displayedComments).forEach((e,n)=>{t.appendChild(this.createCommentElement(e,n))}),this.container.appendChild(t)}createCommentElement(t,e){const n=t.author?.[0]?.name?.$t||"Anonymous",o=this.getAvatarUrl(t.author?.[0]?.gd$image?.src),i=t.link?.find(t=>"alternate"===t.rel)?.href||"#",s=t.content?.$t.replace(/(<([^>]+)>)/gi,"")||"",a=new Date(t.published.$t).toLocaleString(),r=s.length>config.characters?s.substring(0,config.characters)+"â€¦":s,l=config.showMoreLink&&s.length>config.characters?`<a href="${i}" class="more-link">${config.moreLinkText}</a>`:"",c=document.createElement("div");return c.className="comment",c.setAttribute("role","listitem"),c.style.animationDelay=`${.1*e}s`,c.innerHTML=`${config.showAvatar?`<img class="avatar ${config.roundAvatar?"round":""}" src="${o}" alt="Avatar of ${n}" loading="lazy" width="${config.avatarSize}" height="${config.avatarSize}">`:""}<div class="comment-content"><div class="comment-header"><a href="${i}" class="author" rel="nofollow">${n}</a><time class="comment-date" datetime="${t.published.$t}">${a}</time></div><p>${r}${l}</p></div>`,c}getAvatarUrl(t){return t?t.includes("/s1600/")?t.replace("/s1600/","/s"+config.avatarSize+"-c/"):t.includes("/s220/")?t.replace("/s220/","/s"+config.avatarSize+"-c/"):t.includes("blank.gif")?config.defaultAvatar:t:config.defaultAvatar}setupIntersectionObserver(){const t=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("animate"),t.unobserve(t.target))})},{threshold:.1});this.container.querySelectorAll(".comment").forEach(e=>t.observe(e))}async loadMore(){this.isLoadingMore||(this.isLoadingMore=!0,this.loadMoreBtn.disabled=!0,this.loadMoreBtn.textContent="Loading...",this.displayedComments+=config.loadMoreCount,this.renderComments(),this.updateUI(),this.isLoadingMore=!1,this.loadMoreBtn.disabled=!1,this.loadMoreBtn.textContent="Load More Comments",this.loadMoreBtn.focus())}updateUI(){this.countElement.textContent=`${Math.min(this.displayedComments,this.allComments.length)} of ${this.allComments.length} comments`,this.loadMoreBtn.classList.toggle("hidden",this.displayedComments>=this.allComments.length)}showLoader(t){this.loader.classList.toggle("hidden",!t)}showError(){this.container.innerHTML='<div class="error-message" role="alert">Failed to load comments.<button id="retry-btn" class="retry-btn">Retry</button></div>',document.getElementById("retry-btn").addEventListener("click",()=>this.fetchComments())}}new CommentsWidget;
